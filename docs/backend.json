{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user in the EduBot Central application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "name": {
          "type": "string",
          "description": "The display name of the user."
        },
        "roles": {
          "type": "array",
          "description": "The roles of the user (e.g., student, class-representative, senior, admin, official).",
          "items": {
            "type": "string"
          }
        },
        "collegeYear": {
          "type": "string",
          "description": "The user's current year in college."
        },
        "semester": {
          "type": "string",
          "description": "The user's current semester."
        },
        "accessCodeUsed": {
            "type": "string",
            "description": "The access code used by the user to sign up, if applicable."
        },
        "status": {
            "type": "string",
            "description": "The status of the user's account (e.g., active, disabled)."
        }
      },
      "required": [
        "id",
        "email",
        "roles",
        "name"
      ]
    },
    "Content": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Content",
      "type": "object",
      "description": "Represents a piece of academic content like a note, PYQ, or important question.",
      "properties": {
        "title": {
          "type": "string",
          "description": "The title of the content."
        },
        "subject": {
          "type": "string",
          "description": "The academic subject this content belongs to."
        },
        "type": {
          "type": "string",
          "description": "The type of content.",
          "enum": ["Class Notes", "PYQ", "Important Question"]
        },
        "content": {
          "type": "string",
          "description": "The main body of the academic content, can contain Markdown."
        },
        "authorId": {
          "type": "string",
          "description": "The UID of the user who created this content."
        },
        "authorName": {
          "type": "string",
          "description": "The display name of the user who created this content."
        },
        "fileUrl": {
          "type": "string",
          "description": "The URL of the uploaded image or PDF file."
        },
        "fileType": {
          "type": "string",
          "description": "The MIME type of the uploaded file (e.g., 'image/jpeg', 'application/pdf')."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp when the content was created."
        },
        "updatedAt": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp when the content was last updated."
        }
      },
      "required": [
        "title",
        "subject",
        "type",
        "content",
        "authorId",
        "authorName",
        "createdAt"
      ]
    },
    "AccessCode": {
        "title": "Access Code",
        "description": "Represents a single-use or multi-use access code for signing up with special roles.",
        "type": "object",
        "properties": {
            "code": { "type": "string", "description": "The access code string itself." },
            "role": { "type": "string", "description": "The role to be assigned upon using this code (e.g., 'official')." },
            "isActive": { "type": "boolean", "description": "Whether the code is currently active and can be used." },
            "isSingleUse": { "type": "boolean", "description": "If true, the code can only be used once." },
            "used": { "type": "boolean", "description": "If the single-use code has been used." },
            "expiresAt": { "type": "string", "format": "date-time", "description": "An optional expiration date for the code." }
        },
        "required": ["code", "role", "isActive", "isSingleUse"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Uses path-based ownership; only the authenticated user can access their own profile.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user, matching the Firebase Auth UID."
            }
          ]
        }
      },
      {
        "path": "/content/{contentId}",
        "definition": {
          "entityName": "Content",
          "schema": {
            "$ref": "#/backend/entities/Content"
          },
          "description": "Stores academic content created by users. Write access is controlled by ownership.",
          "params": [
            {
              "name": "contentId",
              "description": "The unique identifier for the content document."
            }
          ]
        }
      },
      {
          "path": "/accessCodes/{codeId}",
          "definition": {
              "entityName": "AccessCode",
              "schema": { "$ref": "#/backend/entities/AccessCode" },
              "description": "Stores access codes for special sign-ups. These should only be readable by authenticated users during signup and not be listable.",
              "params": [{
                  "name": "codeId",
                  "description": "The document ID, which is the access code string itself."
              }]
          }
      }
    ],
    "reasoning": "This Firestore structure prioritizes security and scalability. User data is isolated under `/users/{userId}` with strict ownership rules. The top-level `/content` collection stores all academic materials. Security rules for `/content` will ensure that while any authenticated user can create content, only the original author (authorId) can update or delete their own contributions. A new `/accessCodes` collection is added to manage signups for privileged roles, with rules to prevent enumeration."
  }
}
